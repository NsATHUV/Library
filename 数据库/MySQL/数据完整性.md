---
tags:
  - MySQL
  - 内容
aliases:
  - 完整性
日月: 2024-11-26
时分: 16:08
---
**数据完整性**指存储在数据库中的数据应保持准确性和可靠性。比如，数据库中出现学号重复的情况就破坏了数据的准确性。

数据库通过以下方式保证数据完整性：

- **外键**：确保表与表之间的参照关系完整性。
- **约束**：通过主键、唯一约束、非空约束等保证字段和记录的正确性。
- **触发器**：在特定事件发生时自动执行特定逻辑，以维护数据一致性。

---

## 数据完整性的四大分类

1. **实体完整性**
2. **域完整性**
3. **参照完整性**
4. **自定义完整性**

---

### 1. 实体完整性

**实体完整性**保证数据库中记录的唯一性。它的核心原则包括：

- 每一行数据在表中都必须能够被唯一标识。
- 表中的主属性（通常为主键）必须满足以下要求：
    - **不能为 NULL**。
    - **不能有重复值**。

**实现方法**：

- 使用 **主键** 或 **唯一索引**。
- 通过 `PRIMARY KEY` 或 `UNIQUE` 关键字定义。

**示例**：

```sql
CREATE TABLE students (
    student_id INT PRIMARY KEY, -- 主键保证唯一性和非空
    name VARCHAR(50) NOT NULL
);
```

---

### 2. 域完整性

**域完整性**是对表中字段的约束，确保每个字段的数据有效性。

**约束方式**：

- 数据类型（`INT`, `VARCHAR` 等）。
- 允许的取值范围（通过 `CHECK` 约束定义）。
- 缺省值（`DEFAULT` 关键字）。
- 是否允许为空（`NOT NULL`）。

**特点**：

- 限制字段的数据类型和输入规则。
- 确保字段中不会存储无效值。

**示例**：

```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0), -- 价格必须为正
    stock INT DEFAULT 0 -- 缺省值为 0
);
```

---

### 3. 参照完整性

**参照完整性**保证多表之间的关系一致性，通常通过 **外键** 实现。

**设计场景**：

- **一对多**：如订单表和客户表，每个订单必须关联一个客户。
- **多对多**：如学生表和课程表，通过中间表实现关联。
- **一对一**：如用户信息表和用户认证表。

**特点**：

- 外键字段的值必须匹配父表中主键或唯一键的值，或者为 NULL（若允许）。
- 支持级联操作（如 `ON DELETE CASCADE`）。

**示例**：

```sql
CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) -- 外键约束
    ON DELETE CASCADE -- 删除客户时自动删除相关订单
);
```

---

### 4. 自定义完整性

**自定义完整性**是根据特定业务需求，对数据库中特定字段或记录定义的约束规则，确保数据符合应用语义。

**特点**：

- 通常由业务规则驱动。
- 涉及对特定字段或字段组合的复杂约束。

**示例规则**：

- 某个字段的取值范围在 0-100 之间。
- 某个非主属性也不能为 NULL。
- 某个字段的值必须唯一。

**实现方法**：

- 使用触发器。
- 使用复杂的 `CHECK` 约束。

**示例**：

```sql
CREATE TABLE exams (
    exam_id INT PRIMARY KEY,
    score INT CHECK (score BETWEEN 0 AND 100) -- 成绩必须在 0 到 100 之间
);

CREATE TABLE employees (
    emp_id INT PRIMARY KEY,
    phone_number VARCHAR(15) UNIQUE NOT NULL -- 电话号码必须唯一且非空
);
```

---

## 数据完整性总结

- **实体完整性**：通过主键和唯一约束，确保记录唯一性。
- **域完整性**：通过字段属性（数据类型、默认值、非空等），确保字段值的有效性。
- **参照完整性**：通过外键约束，维护表与表之间的关系一致性。
- **自定义完整性**：通过业务规则和语义约束，确保符合具体应用的需求。

每种完整性约束都有其适用场景，综合使用这些方法，可以确保数据库中的数据准确可靠。